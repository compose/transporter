language: go
go:
  - 1.7.x
before_install:
  - go get github.com/mattn/goveralls
script:
  - ./scripts/tests.sh
  - $HOME/gopath/bin/goveralls -service=travis-ci -coverprofile=/tmp/coverage.out
services:
  - mongodb
  - postgresql
addons:
  postgresql: '9.4'
  apt:
    sources:
      - elasticsearch-2.x
    packages:
      - elasticsearch
before_script:
  - psql -c "ALTER SYSTEM SET max_replication_slots = 4"
  - psql -c "ALTER SYSTEM SET wal_level = logical"
  - sudo /etc/init.d/postgresql restart; sleep 1
  - echo "replSet = transporterRs" | sudo tee -a /etc/mongodb.conf
  - sudo service mongodb restart
  - sleep 20
  - mongo --eval 'rs.initiate()'
  - sleep 15
  - elasticsearch -d --default.path.conf=config
  - sleep 15
  - elasticsearch -v
  - curl http://localhost:9200/
install: true
branches:
  only:
  - experimental
notifications:
  slack:
    secure: R8wvRnq0DcxiFNgUvJ3npnzY2LzU8uVyF8enqfxXNuSR3jRC2tqUosB5Qzb1CCiNicmpEwj3VTcwTozzCwcqckysFek3Pp2/oxYL8tRjqxks1zUeMHVv204l83Js8PAFVhODCQjIxZNQCdUM2fQ9q46MvdY7V8h/wGTbQKq1ZLE=
